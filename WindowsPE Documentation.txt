How to inject drivers into WindowsPE for imaging

Mass storage drivers
Network drivers

1. Open Deployment and Imaging Tools Environment
    Start > Search for "Deployment and Imaging Tools Environment"
2. Copy WindowsPE to local drive
    Run command 'CopyPE amd64 [destination]' (example destination: C:Deployment\WinPEx64)
3. Navigate to the WinPE Sources folder
    CD [destination]\WinPEx64\media\sources (example destination C:Deployment\WinPEx64\media\Sources)
4. Mount the boot.wim file
    Mount-WindowsImage -ImagePath "C:\Deployment_Test\WinPEx64\media\sources\boot.wim" -Index 1 -Path "C:\Deployment_Test\Wim_Mounts\WinPE"
5. Install drivers
    Add-WindowsDriver -Path "C:\Deployment_Test\Wim_Mounts\WinPE" -Driver "C:\Deployment_Test\Drivers\Lenovo\Thinkpad\P51\TP_P51_P71_W1064_1903_201904\Storage\" -Recurse
    Add-WindowsDriver -Path "C:\Deployment_Test\Wim_Mounts\WinPE" -Driver "C:\Deployment_Test\Drivers\Lenovo\Thinkpad\P51\TP_P51_P71_W1064_1903_201904\Ethernet\" -Recurse
    Add-WindowsDriver -Path "C:\Deployment_Test\Wim_Mounts\WinPE" -Driver "C:\Deployment_Test\Drivers\Lenovo\Thinkpad\X1 Carbon\6th Generation\TP_X1Carbon_MT20KG-20KH_W1064_1809_201906\Ethernet" -Recurse
    Add-WindowsDriver -Path "C:\Deployment_Test\Wim_Mounts\WinPE" -Driver "C:\Deployment_Test\Drivers\Lenovo\Thinkpad\X1 Carbon\6th Generation\TP_X1Carbon_MT20KG-20KH_W1064_1809_201906\Storage" -Recurse
6. Dimount the WindowsPE folder and save all changes
    Dismount-WindowsImage -Path "C:\Deployment_Test\Wim_Mounts\WinPE" -Save
7. Create WinPE media
    MakeWinPEMedia /UFD [source] [destination]